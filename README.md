# sporeseg

This repository implements a small tool allowing to segment spores in microscopy images, classify them according to their shape, and produce a summary in the form of shape histograms.

## Detection and classification

Spores are detected following a simple image processing sequence in two steps: rough spore localization followed by fine local segmentation. This is required to take into account possible uneven illuminations forbidding the use a simple glboal thresholding method.

Rough localization is based on the detection of spores edges. First, noise is filtered out by appling a median filter. To gain computational speed, the image is first downscaled by a factor two and a median filter of radius 5 pixels is used, after which the image is upscaled back to its original size. A gradient filter with a radius of two pixels is then applied to highlight the spore edges, and a binary mask is generated by thresholding that filtered image. The resulting rough spore contours are further  morphologically thinned to obtain a line contour, and slightly re-expanded by a one pixel dilation. Finally, the rough spore segmentation corresponds to the pixels in the interior of those contours. The obtained regions are analyzed and a size filtering is applied to remove missegmentations (e.g. from dust particles). A size threshold is easily set thanks to the very consistent size of the spores. The remaining regions are then used in step two of the procedure.

Small subimages centered on the detected regions (bounding box $\pm$ 10 pixels) are extracted and automatically thresholded. The resulting binary objects are the segmented spores. The roundness of spores is measured using the eccentricity parameter of the segmented shapes which takes values between 0 (perfect circle) and 1 (line). Test samples containing only one type of spores (round or elongated) are used to set an optimal eccentricity threshold to assign spores from mixed samples to shape categories. Finally, the data from a complete set of images for a given condition are pooled together to measure the fraction of round spores.

## Installation:

This repository contains both the package implementing the analysis desribed above and example notebooks and scripts to run the analysis. See for example the [Spore_segmentation_demo.ipynb](notebooks/Spore_segmentation_demo.ipynb) noteook to see how to use the package. The package can be intalled directly using pip. We recommend creating a closed environment using conda e.g.

```
conda create -n spores pip
source activate spores
pip install git+https://github.com/guiwitz/sporeseg.git@master#egg=sporeseg

```
To update the package after new releases, just type:
```
source activate spores
pip install --upgrade git+https://github.com/guiwitz/sporeseg.git@master#egg=sporeseg
```

To obtain the notebooks and scritps, simply clone this repository (you won't need the downloaded package which is installed directly through Github). However, for a developement installation, cd to the cloned folder and type:

```
pip install -e .
```

The -e flag is important if you want to be able to edit the code and be able to reload the package without re-installing it.
