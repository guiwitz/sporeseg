# sporeseg

This repository implements a tool allowing to segment spores in microscopy images and classify them according to their shape. The basic functioning of the tool is demonstrated in the [Spore_segmentation_demo.ipynb](notebooks/Spore_segmentation_demo.ipynb) notebook.

## Detection and classification

Spores are detected following a simple image processing sequence in two steps: rough spore localization followed by fine local segmentation. This is required to take into account possible uneven illuminations forbidding the use a simple global thresholding method.

Rough localization is based on the detection of spores edges. First, noise is filtered out by applying a median filter. To gain computational speed, the image is first downscaled by a factor two and a median filter of radius 5 pixels is used, after which the image is upscaled back to its original size. A gradient filter with a radius of two pixels is then applied to highlight the spore edges, and a binary mask is generated by thresholding that filtered image. The resulting rough spore contours are further  morphologically thinned to obtain a line contour, and slightly re-expanded by a one pixel dilation. Finally, the rough spore segmentation corresponds to the pixels in the interior of those contours. The obtained regions are analyzed and a size filtering is applied to remove mis-segmentations (e.g. from dust particles). A size threshold is easily set thanks to the very consistent size of the spores. The remaining regions are then used in step two of the procedure.

Small subimages centered on the detected regions (bounding box Â± 10 pixels) are extracted and automatically thresholded. The resulting binary objects are the segmented spores. The roundness of spores is measured using the eccentricity parameter of the segmented shapes which takes values between 0 (perfect circle) and 1 (line). Test samples containing only one type of spores (round or elongated) are used to set an optimal eccentricity threshold to assign spores from mixed samples to shape categories. Finally, the data from a complete set of images for a given condition are pooled together to measure the fraction of round spores.

## Installation:

This repository contains both the package implementing the analysis described above and example notebooks and scripts to run the analysis. See for example the [Spore_segmentation_demo.ipynb](notebooks/Spore_segmentation_demo.ipynb) notebook to see how to use the package. The package can be installed directly using pip. We recommend creating a closed environment using conda. To install the latest version of the software use:

```
conda create -n spores pip
source activate spores
pip install git+https://github.com/guiwitz/sporeseg.git@master#egg=sporeseg
```

If instead of the latest version you want to install a specific version, for example the version ```v0.0.2```, just change the last line to:

```
pip install git+https://github.com/guiwitz/sporeseg.git@v0.0.2#egg=sporeseg
```

:warning: The package has changed name from the initial version ```v0.0.1``` so that repository name and package name match. If you want to install the initial version, please use:

```
pip install git+https://github.com/guiwitz/sporeseg.git@v0.0.1#egg=spores
```

## Updating

If you use the latest releases and just want to update the package you can use this command:
```
source activate spores
pip install --upgrade git+https://github.com/guiwitz/sporeseg.git@master#egg=sporeseg
```

## Using the notebooks and scripts

To obtain the notebooks and scripts, simply clone this repository using ```git clone``` or download the repository using [this link](https://github.com/guiwitz/sporeseg/archive/refs/tags/v0.0.1.zip). Jupyter is not installed by default when installing ```sporeseg```, so install it in the same environment using e.g. pip:
```
pip install jupyter
```

## Development installation

For a development installation, ```cd``` to the cloned folder and install the package using:

```
pip install -e .
```

The -e flag is important if you want to be able to edit the code and be able to reload the package without re-installing it.

## Authors

This tools has been developed by Guillaume Witz (MIC-ScITS, Bern University) in collaboration with Eugene Gladyshev (Group Fungal Epigenomics, Institut Pasteur). This tool has been used in the frame of the publication **Recombination-independent recognition of DNA homology for meiotic silencing in Neurospora crassa**, N. Rhoades, T.-S. Nguyen, G. Witz, G. Cecere,  T. Hammond, A. K. Mazur, E. Gladyshev, *bioRxiv*, https://doi.org/10.1101/573907
